{"ast":null,"code":"/** @jsx h */\nimport { h } from 'preact';\nimport { deserializePayload } from \"../utils/index.js\";\nimport { readDataAttributes, hasDataAttributes } from \"../../helpers/insights.js\";\n\nvar findInsightsTarget = function findInsightsTarget(startElement, endElement, validator) {\n  var element = startElement;\n\n  while (element && !validator(element)) {\n    if (element === endElement) {\n      return null;\n    }\n\n    element = element.parentElement;\n  }\n\n  return element;\n};\n\nvar parseInsightsEvent = function parseInsightsEvent(element) {\n  var serializedPayload = element.getAttribute('data-insights-event');\n\n  if (typeof serializedPayload !== 'string') {\n    throw new Error('The insights middleware expects `data-insights-event` to be a base64-encoded JSON string.');\n  }\n\n  try {\n    return deserializePayload(serializedPayload);\n  } catch (error) {\n    throw new Error('The insights middleware was unable to parse `data-insights-event`.');\n  }\n};\n\nvar insightsListener = function insightsListener(BaseComponent) {\n  function WithInsightsListener(props) {\n    var handleClick = function handleClick(event) {\n      if (props.sendEvent) {\n        // new way with insights middleware\n        var targetWithEvent = findInsightsTarget(event.target, event.currentTarget, function (element) {\n          return element.hasAttribute('data-insights-event');\n        });\n\n        if (targetWithEvent) {\n          var payload = parseInsightsEvent(targetWithEvent);\n          payload.forEach(function (single) {\n            return props.sendEvent(single);\n          });\n        }\n      } // old way, e.g. instantsearch.insights(\"clickedObjectIDsAfterSearch\", { .. })\n\n\n      var insightsTarget = findInsightsTarget(event.target, event.currentTarget, function (element) {\n        return hasDataAttributes(element);\n      });\n\n      if (insightsTarget) {\n        var _readDataAttributes = readDataAttributes(insightsTarget),\n            method = _readDataAttributes.method,\n            _payload = _readDataAttributes.payload;\n\n        props.insights(method, _payload);\n      }\n    };\n\n    return h(\"div\", {\n      onClick: handleClick\n    }, h(BaseComponent, props));\n  }\n\n  return WithInsightsListener;\n};\n\nexport default insightsListener;","map":null,"metadata":{},"sourceType":"module"}